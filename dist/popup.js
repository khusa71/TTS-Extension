(()=>{"use strict";document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("apiKey"),t=document.getElementById("saveApiKey"),o=document.getElementById("apiKeyStatus"),n=document.getElementById("voiceSelect"),s=(document.getElementById("voiceInfo"),document.getElementById("speedRange")),a=document.getElementById("speedValue"),l=document.querySelectorAll(".speed-preset"),d=(document.getElementById("readSelected"),document.getElementById("readPage"),document.getElementById("pause"),document.getElementById("resume"),document.getElementById("stop"),document.getElementById("next"),document.getElementById("previous"),document.getElementById("enableHighlight")),c=document.getElementsByName("highlightType");document.getElementById("progress-container"),document.getElementById("progress-fill"),document.getElementById("currentTime"),document.getElementById("totalTime"),function(e){const{onboardingModal:t,closeOnboarding:o,themeToggle:n,apiKeyStatus:s,speedRange:a,speedValue:l,speedPresets:d,enableHighlight:c,highlightOptions:i,showOnboardingCallback:g,hideOnboardingCallback:r,updateSpeedPresets:m,updateSettings:u,showStatusCallback:y}=e;function p(){t.style.display="flex",o.focus()}function h(){t.style.display="none"}var E;o&&o.addEventListener("click",h),window.addEventListener("keydown",(e=>{"flex"!==t.style.display||"Escape"!==e.key&&"Enter"!==e.key||h()})),localStorage.getItem("tts_onboarded")||(setTimeout(p,400),localStorage.setItem("tts_onboarded","1")),g&&g(p),r&&r(h),E="1"===localStorage.getItem("tts_theme_dark"),document.body.classList.toggle("dark-mode",E),n&&(n.innerHTML=E?'<i class="fas fa-sun"></i>':'<i class="fas fa-moon"></i>'),n&&n.addEventListener("click",(()=>{const e=document.body.classList.toggle("dark-mode");!function(e){localStorage.setItem("tts_theme_dark",e?"1":"0")}(e),n.innerHTML=e?'<i class="fas fa-sun"></i>':'<i class="fas fa-moon"></i>'})),document.querySelectorAll(".help-icon").forEach((e=>{const t=e.getAttribute("title");t&&(e.setAttribute("aria-label",t),e.setAttribute("role","tooltip"))}))}({onboardingModal:document.getElementById("onboardingModal"),closeOnboarding:document.getElementById("closeOnboarding"),themeToggle:document.getElementById("themeToggle"),apiKeyStatus:o,speedRange:s,speedValue:a,speedPresets:l,enableHighlight:d,highlightOptions:c,showOnboardingCallback:e=>{},hideOnboardingCallback:e=>{},updateSpeedPresets:e=>{l.forEach((t=>{const o=parseFloat(t.dataset.speed||"1");t.classList.toggle("active",o===parseFloat(e.toString()))}))},updateSettings:e=>{},showStatusCallback:(e,t)=>{}}),console.log("Fetching available voices from Google Cloud TTS API..."),chrome.storage.local.get(["googleApiKey"],(e=>{const t=e.googleApiKey;t?fetch("https://texttospeech.googleapis.com/v1/voices?key="+t).then((e=>{if(!e.ok)throw new Error(`Error fetching voices: ${e.statusText}`);return e.json()})).then((e=>{const t=e.voices||[];console.log("Voices fetched from Google Cloud TTS API:",t),n.innerHTML="",t.forEach((e=>{const t=document.createElement("option");t.value=e.name,t.textContent=`${e.name} (${e.languageCodes.join(", ")})`,t.dataset.language=e.languageCodes[0],t.dataset.gender=e.ssmlGender||"unknown",n.appendChild(t)}))})).catch((e=>{console.error("Error fetching voices from Google Cloud TTS API:",e)})):console.error("API key is missing. Please set it in the extension settings.")})),t.addEventListener("click",(()=>{const t=e.value.trim();t?chrome.storage.local.set({googleApiKey:t},(()=>{chrome.runtime.sendMessage({action:"apiKeyUpdated",newKey:t}),o.textContent="API Key saved successfully!",o.className="success-message",setTimeout((()=>{o.textContent=""}),3e3)})):(o.textContent="Please enter a valid API key.",o.className="error-message")}))}))})();