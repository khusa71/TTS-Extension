(()=>{"use strict";const t={enabled:!0,type:"word",color:"#000000",backgroundColor:"rgba(255, 245, 157, 0.5)",useBold:!1,useUnderline:!1,transitionSpeed:"medium"};!function(){function e(t="\n        .tts-highlight-line {\n            background: rgba(255, 245, 157, 0.5);\n            border-radius: 3px;\n            transition: background 0.3s ease;\n        }\n        .tts-highlight-word {\n            background: rgba(255, 245, 157, 0.9);\n            border-radius: 2px;\n            transition: all 0.2s ease;\n        }\n        .tts-highlight-container {\n            display: inline;\n            position: relative;\n        }\n    "){const e=document.getElementById("tts-highlight-styles");if(e)return void(e.textContent=t);const n=document.createElement("style");n.id="tts-highlight-styles",n.textContent=t,document.head.appendChild(n)}function n(){document.querySelectorAll(".tts-highlight-line, .tts-highlight-word, .tts-highlight-container").forEach((t=>{if(t.classList.contains("tts-highlight-container")){const e=t.parentNode;if(!e)return;for(;t.firstChild;)e.insertBefore(t.firstChild,t);e.removeChild(t)}else t.outerHTML=t.textContent||""}))}function o(t){const e=[],n=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:function(t){if(!t.parentElement)return NodeFilter.FILTER_REJECT;const e=t.parentElement,n=window.getComputedStyle(e);return"none"!==n.display&&"hidden"!==n.visibility&&!e.closest("script, style")&&t.textContent&&t.textContent.trim()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});let o;for(;o=n.nextNode();){const n=(o.textContent||"").indexOf(t);-1!==n&&e.push({node:o,startIndex:n,endIndex:n+t.length})}return e}e(),chrome.runtime.onMessage.addListener(((i,r,s)=>("highlightText"===i.action?(function(i,r=t){n(),e(function(t){if(!t.enabled)return"";const e={slow:"0.5s",medium:"0.3s",fast:"0.1s"};return`\n    .tts-highlight-line {\n      background: ${t.backgroundColor};\n      ${"#000000"!==t.color?`color: ${t.color};`:""}\n      ${t.useBold?"font-weight: bold;":""}\n      ${t.useUnderline?"text-decoration: underline;":""}\n      border-radius: 3px;\n      transition: all ${e[t.transitionSpeed]} ease;\n    }\n    .tts-highlight-word {\n      background: ${t.backgroundColor};\n      ${"#000000"!==t.color?`color: ${t.color};`:""}\n      ${t.useBold?"font-weight: bold;":""}\n      ${t.useUnderline?"text-decoration: underline;":""}\n      border-radius: 2px;\n      transition: all ${e[t.transitionSpeed]} ease;\n    }\n    .tts-highlight-container {\n      display: inline;\n      position: relative;\n    }\n  `}(r)),i&&r.enabled&&o(i).forEach((t=>{const e=t.node,n=e.parentNode;if(!n)return;const o=document.createElement("span");o.className="word"===r.type?"tts-highlight-word":"tts-highlight-line";const i=e.textContent?.substring(0,t.startIndex)||"",s=e.textContent?.substring(t.startIndex,t.endIndex)||"",d=e.textContent?.substring(t.endIndex)||"",l=document.createTextNode(i),a=document.createTextNode(d);o.textContent=s;const c=document.createElement("span");c.className="tts-highlight-container",c.appendChild(l),c.appendChild(o),c.appendChild(a),n.replaceChild(c,e),t.element=o}))}(i.text||"",i.options),s({success:!0})):"clearHighlights"===i.action&&(n(),s({success:!0})),!0))),chrome.runtime.onMessage.addListener(((t,e,i)=>{var r;"highlightText"===t.action&&t.text&&(r=t.text,n(),o(r).forEach((t=>{const e=document.createRange();e.setStart(t.node,t.startIndex),e.setEnd(t.node,t.endIndex);const n=document.createElement("span");n.className="tts-highlight-word",e.surroundContents(n)})),i({success:!0}))}))}()})();